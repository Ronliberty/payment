{% extends 'dashboard/base.html' %}
{% load static %}
{% block content %}
 <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="col-span-1">
            <div class="card">
                <h2 class="text-lg font-semibold mb-4">Account Balance</h2>
                <div class="text-3xl font-bold text-black"> {{ wallet.currency }}{{ wallet.balance|floatformat:2 }}</div>
                <div class="mt-4">
                    <button id="add-funds-btn" class="bg-white text-black border border-black px-4 py-2 rounded-lg hover:bg-gray-100">Add Funds</button>
                    <button id="withdraw-funds-btn" class="bg-white text-black border border-black px-4 py-2 rounded-lg hover:bg-gray-100 ml-2">Withdraw</button>
                </div>
            </div>
        </div>

        <div class="col-span-2" id="main-content">
            <div class="card">
              <h2 class="text-lg font-semibold mb-4">Recent Transactions</h2>
        <div class="space-y-4">

            {% for tx in transactions %}
            <div class="transaction-item p-4 rounded-lg bg-gray-100">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <img class="h-8 w-8 rounded-full mr-3" src="https://img.icons8.com/doodle/96/null/user-male-circle.png" alt="User Avatar">
                        <div>
                            <div class="font-semibold">{{ tx.transaction_type|capfirst }} {% if tx.receiver %}to {{ tx.receiver.get_full_name|default:tx.receiver.username }}{% endif %}</div>
                            <div class="text-sm text-gray-600">{{ tx.timestamp|date:"F d, Y" }}</div>
                        </div>
                    </div>
                    <div class="font-semibold {% if tx.transaction_type == 'withdrawal' or tx.transaction_type == 'transfer' %}text-red-500{% else %}text-green-500{% endif %}">
                        {% if tx.transaction_type == 'withdrawal' or tx.transaction_type == 'transfer' %}-{% else %}+{% endif %}
                        {{ tx.amount|floatformat:2 }}
                    </div>
                </div>
            </div>
            {% empty %}
                <p>No recent transactions.</p>
            {% endfor %}

        </div>




    <div class="mt-8">
        <button id="send-money-btn" class="bg-white text-black border border-black px-4 py-2 rounded-lg hover:bg-gray-100">Send Money</button>
        <div id="send-money-form" class="hidden card mt-4 p-4 w-full max-w-sm">
            <h2 class="text-lg font-semibold mb-4">Send Money</h2>
            <form class="space-y-3" hx-post="/send-money" hx-target="#transaction-list" hx-swap="innerHTML">
                <div>
                    <label class="block text-sm font-medium text-black">Recipient Email</label>
                    <input type="email" name="email" class="mt-1 block w-full px-2 py-1.5 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-black focus:border-black" placeholder="Enter email">
                </div>
                <div>
                    <label class="block text-sm font-medium text-black">Amount</label>
                    <input type="number" name="amount" class="mt-1 block w-full px-2 py-1.5 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-black focus:border-black" placeholder="Enter amount">
                </div>
                <div>
                    <button type="submit" class="w-full bg-white text-black border border-black px-4 py-2 rounded-lg hover:bg-gray-100">Send</button>
                </div>
            </form>
        </div>
    </div>
<footer class="bg-white text-black py-6 mt-8 border-t">
    <div class="container mx-auto px-4 text-center">
        <p>&copy; 2023 FlowPay. All rights reserved.</p>
        <div class="mt-2">
            <a href="#" class="text-sm hover:underline text-black">Privacy Policy</a> |
            <a href="#" class="text-sm hover:underline text-black">Terms of Service</a>
        </div>
    </div>
</footer>

<!-- Modals -->
<div id="add-funds-modal" class="hidden modal-overlay">
    <div class="modal-container">
        <button class="close-modal">&times;</button>
        <h2 class="text-lg font-semibold mb-4">Add Funds</h2>
        <form method="post" action="{% url 'payment:deposit' %}" class="space-y-3">
            {% csrf_token %}

            {% if form.non_field_errors %}
                <div class="mb-4 p-4 bg-red-50 text-red-700 rounded">
                    {{ form.non_field_errors }}
                </div>
            {% endif %}

            <div>
                <label class="block text-sm font-medium text-black">Amount</label>
                <input
                    type="number"
                    name="amount"
                    class="mt-1 block w-full px-2 py-1.5 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-black focus:border-black"
                    placeholder="Enter amount"
                    required
                    id="id_amount"
                    value="{{ form.amount.value|default:'' }}"
                >
                {% for error in form.amount.errors %}
                    <p class="text-red-500 text-xs mt-1">{{ error }}</p>
                {% endfor %}
            </div>
            <div>
                <button type="submit" class="w-full bg-white text-black border border-black px-4 py-2 rounded-lg hover:bg-gray-100">
                    Add Funds
                </button>
            </div>
        </form>
    </div>
</div>
<div id="withdraw-funds-modal" class="hidden modal-overlay">
    <div class="modal-container">
        <button class="close-modal">&times;</button>
        <h2 class="text-lg font-semibold mb-4">Withdraw Funds</h2>
        <form method="post" action="{% url 'payment:withdraw' %}" class="space-y-3">
            {% csrf_token %}
            <div>
                <label class="block text-sm font-medium text-black">Amount</label>
                <input
                    type="number"
                    name="amount"
                    step="0.01"
                    class="mt-1 block w-full px-2 py-1.5 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-black focus:border-black"
                    placeholder="Enter amount"
                    required>
            </div>
            <div>
                <label class="block text-sm font-medium text-black">M-Pesa Phone Number</label>
                <input
                    type="text"
                    name="phone_number"
                    class="mt-1 block w-full px-2 py-1.5 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-black focus:border-black"
                    placeholder="e.g. 254712345678"
                    required>
            </div>
            <div>
                <button type="submit" class="w-full bg-white text-black border border-black px-4 py-2 rounded-lg hover:bg-gray-100">Withdraw</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}

